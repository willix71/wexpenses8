<ui:component xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:c="http://java.sun.com/jstl/core"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:wex="http://java.sun.com/jsf/composite/wex-cc"
	xmlns:composite="http://java.sun.com/jsf/composite">
   	
	<composite:interface>
		<composite:attribute name="rows" default="10" />
	</composite:interface>
	
	<composite:implementation>
		<c:set var="conso" value="#{consolidationEditionController.currentElement}" />
			
		<wex:dbableDetails dbable="#{conso}"/>
		
		<h:panelGrid columns="2" rendered="#{not empty conso}" style="width:100%">
			<h:outputText value=""/>
			<p:messages showDetail="true" showSummary="true" />
			
			<h:outputText value="date" styleClass="wex-field-label"/>
			<h:outputText value="#{conso.date}" >
				<f:convertDateTime type="localDateTime" pattern="MMM yyyy" />
			</h:outputText>
		
			<h:outputText value="institution" styleClass="wex-field-label"/>
			<p:outputPanel id="payeeSelector">
				<wex:payeeSelector payee="#{conso.institution}" edition="false" />
			</p:outputPanel>
			
			<h:outputText value="document" styleClass="wex-field-label"/>
			<p:outputPanel id="documentFileSelector">
				<wex:documentFileEdition docFile="#{conso.documentFile}" extra="#{conso}" edition="false" />
			</p:outputPanel>

			<h:outputText value="opening value" styleClass="wex-field-label"/>
			<h:outputText value="#{conso.openingValue}" />

			<h:outputText value="closing value" styleClass="wex-field-label"/>
			<h:outputText value="#{conso.closingValue}" />

			<h:outputText value="delta value" styleClass="wex-field-label"/>
			<h:outputText value="#{conso.deltaValue}" />										
		</h:panelGrid>
		
		<p:dataTable id="consoTransactionEntries" styleClass="js-wexTable" var="xct" value="#{consolidationEditionController.entries.target}" resizableColumns="true"
			paginator="true" 
			rowsPerPageTemplate="10,50,100,1000"
			rows="#{cc.attrs.rows}"
			currentPageReportTemplate="{startRecord}-{endRecord} of {totalRecords} records">
				<f:facet name="header">
					<p:commandButton id="toggler" type="button" value="Columns" style="float:right" icon="pi pi-align-justify" />
					<p:columnToggler datasource="consoTransactionEntries" trigger="toggler" />
				</f:facet>

				<ui:include src="/includes/dbableColumns.xhtml">
					<ui:param name="dba" value="#{xct}" />
				</ui:include>
		
				<p:column styleClass="wex-cell-righted" style="width:20px" >
					<h:outputText value="#{xct.accountingOrder % 1000}" />
					
					<f:facet name="footer">
						<h:outputText value="#{consolidationEditionController.entries.target.size()}" />
					</f:facet>
				</p:column>
				
				<p:column headerText="Date" styleClass="wex-cell-righted" style="width:90px" >
					<h:outputText value="#{xct.accountingDate}" >
						<f:convertDateTime type="localDateTime" pattern="dd/MM/yyyy" />
					</h:outputText>
				</p:column>
			
				<p:column headerText="Consolidated" styleClass="wex-cell-righted" style="width:90px" >
					<h:outputText value="#{xct.consolidation.date}" >
						<f:convertDateTime type="localDateTime" pattern="MMM yyyy" />
					</h:outputText>
				</p:column>
			
				<p:column headerText="Payee">
					<h:outputText value="#{xct.expense.payee.prefix}#{xct.expense.payee.name} #{xct.expense.payee.extra}" />
				</p:column>
			
				<p:column headerText="Description" visible="false">
					<h:outputText value="#{xct.expense.description}" />
				</p:column>
			
				<p:column headerText="Amount" styleClass="wex-cell-righted" style="width:120px" >
					<h:outputText value="#{xct.currencyAmount} #{xct.expense.currencyCode}" />
				</p:column>
			
				<p:column headerText="IN" styleClass="wex-cell-righted" style="width:80px" >
					<h:outputText value="#{xct.accountingValue}" rendered="#{xct.factor=='IN'}"/>
					
					<f:facet name="footer">
						<h:outputText value="#{consolidationEditionController.totalIn}" />
					</f:facet>
				</p:column>
			
				<p:column headerText="OUT" styleClass="wex-cell-righted"  style="width:80px" >
					<h:outputText value="#{xct.accountingValue}" rendered="#{xct.factor=='OUT'}"/>
					
					<f:facet name="footer">
						<h:outputText value="#{consolidationEditionController.totalOut}" />
					</f:facet>
				</p:column>
			
				<p:column headerText="Balance" styleClass="wex-cell-righted"  style="width:80px" >
					<h:outputText value="#{xct.accountingBalance}" />
					
					<f:facet name="footer">
						<h:outputText value="#{consolidationEditionController.lastBalance}" />
					</f:facet>
				</p:column>
			
				<p:column headerText="Accounts" styleClass="wex-cell-righted" >
					<ui:repeat var="t" value="#{xct.tags}">
						<span class="wex-tag wex-tag-#{t.type}">#{t.name}</span> 
					</ui:repeat>
				</p:column>	
		</p:dataTable>	
   	</composite:implementation>
</ui:component>