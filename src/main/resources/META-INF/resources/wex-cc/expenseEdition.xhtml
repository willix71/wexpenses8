<ui:component xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:p="http://primefaces.org/ui"
   	xmlns:composite="http://java.sun.com/jsf/composite">
   	
	<composite:interface>
		<composite:attribute name="expense" type="w.expenses8.data.domain.model.Expense" required="true" />
		<composite:attribute name="edition" default="false" />
	</composite:interface>
	
	<composite:implementation>
		<h:panelGrid columns="3" rendered="#{not empty cc.attrs.expense}">
			<h:panelGroup>
				id: #{cc.attrs.expense.fullId} 
			</h:panelGroup>
			<h:panelGroup>
				created:
				<h:outputFormat value="{0,date,dd/MM/yyyy HH:mm}">
					<f:param value="#{cc.attrs.expense.createdTs}" />
				</h:outputFormat>
			</h:panelGroup>
			<h:panelGroup rendered="#{not empty cc.attrs.expense.modifiedTs}">	
				modified:
				<h:outputFormat value="{0,date,dd/MM/yyyy HH:mm}">
					<f:param value="#{cc.attrs.expense.modifiedTs}" />
				</h:outputFormat>
			</h:panelGroup>
		</h:panelGrid>
		
		<h:panelGrid columns="2" rendered="#{not empty cc.attrs.expense}" style="width:100%">
			<h:outputText value="type" styleClass="wex-field-label"/>
			<h:outputText value="#{cc.attrs.expense.expenseType.name}" rendered="#{not cc.attrs.edition}" styleClass="wex-field-value"/>
			<p:autoComplete id="expenseTypeId" value="#{cc.attrs.expense.expenseType}" rendered="#{cc.attrs.edition}" styleClass="wex-field-edit"
			 	dropdown="true" completeMethod="#{dropboxController.completeExpenseType}" converter="#{expenseTypeConverter}" 
             	var="theme" itemLabel="#{theme.name}" itemValue="#{theme}" forceSelection="true" />
             	
			<h:outputText value="payee" styleClass="wex-field-label"/>
			<h:outputText value="#{cc.attrs.expense.payee.prefix}#{cc.attrs.expense.payee.name} #{cc.attrs.expense.payee.extra}" rendered="#{not cc.attrs.edition}" styleClass="wex-field-value"/>
			<p:autoComplete id="expensePayeeId" value="#{cc.attrs.expense.payee}" rendered="#{cc.attrs.edition}" styleClass="wex-field-edit"
			 	dropdown="true" completeMethod="#{dropboxController.completePayee}" converter="#{payeeConverter}" 
             	var="theme" itemLabel="#{theme.prefix}#{theme.name} #{theme.extra}" itemValue="#{theme}" forceSelection="true" />
			
			<h:outputText value="date" styleClass="wex-field-label"/>
			<h:outputFormat value="{0,date,dd/MM/yyyy HH:mm}" rendered="#{not cc.attrs.edition}" styleClass="wex-field-value">
				<f:param value="#{cc.attrs.expense.date}" />
			</h:outputFormat>
			<p:datePicker id="expenseDateId" value="#{cc.attrs.expense.date}" rendered="#{cc.attrs.edition}"
				pattern="dd/MM/yyyy"
				showIcon="true"
				showButtonBar="true"
				 />
				 
			<h:outputText value="amount" styleClass="wex-field-label"/>
			<h:panelGroup rendered="#{not cc.attrs.edition}" styleClass="wex-field-value">
				<h:outputFormat value="{0,number, ###0.00}">
					<f:param value="#{cc.attrs.expense.currencyAmount}" />
				</h:outputFormat>
				<h:outputText value="#{cc.attrs.expense.currencyCode}"/>
			</h:panelGroup>
			<h:panelGroup rendered="#{cc.attrs.edition}" styleClass="wex-field-edit">
			    <p:inputNumber id="expenseCurrencyAmountId" value="#{cc.attrs.expense.currencyAmount}" thousandSeparator="'"/>  
			    <p:selectOneMenu id="expenseCurrencyCodeId" value="#{cc.attrs.expense.currencyCode}" >
                	<f:selectItems value="#{dropboxController.currencies}" />
            	</p:selectOneMenu>
			</h:panelGroup>

			<h:outputText value="external reference" styleClass="wex-field-label"/>
			<h:outputText value="#{cc.attrs.expense.externalReference}" rendered="#{not cc.attrs.edition}" styleClass="wex-field-value"/>
			<p:inputText id="expenseExternalReferenceId" value="#{cc.attrs.expense.externalReference}" rendered="#{cc.attrs.edition}" styleClass="wex-field-edit"/>
			
			<h:outputText value="description" styleClass="wex-field-label"/>
			<h:outputText value="#{cc.attrs.expense.description}" rendered="#{not cc.attrs.edition}" styleClass="wex-field-value"/>
			<p:inputText id="expenseDescriptionId" value="#{cc.attrs.expense.description}" rendered="#{cc.attrs.edition}" styleClass="wex-field-edit"/>
		</h:panelGrid>

		<p:dataTable id="tran" styleClass="js-transactionEntryTable" var="x" value="#{cc.attrs.expense.transactions}" rowKey="#{x.uid}" resizableColumns="true" >
                        
                <p:column headerText="Id" style="max-width:60px; width:60px">
            		<h:outputText value="#{x.fullId}" />
        		</p:column>
                
                <p:column headerText="Year" style="max-width:70px; width:70px">
            		<h:outputText value="#{x.accountingYear}" rendered="#{not cc.attrs.edition}"/>
            		<p:spinner id="accountingYearId" value="#{x.accountingYear}" rendered="#{cc.attrs.edition}" styleClass="wex-input-70"/>
        		</p:column>

                <p:column headerText="Factor" style="max-width:120px; width:120px">
            		<h:outputText value="#{x.factor}" rendered="#{not cc.attrs.edition}" />
	          		<p:selectOneButton value="#{x.factor}" rendered="#{cc.attrs.edition}" converter="#{transactionFactorConverter}">
	                   	<f:selectItems value="#{dropboxController.transactionFactors}" />
	               	</p:selectOneButton>
        		</p:column>

                <p:column headerText="System" styleClass="wex-cell-centered" style="max-width:50px; width:50px">
            		<h:panelGroup rendered="#{x.systemEntry and not cc.attrs.edition}"><i class="pi pi-check"></i></h:panelGroup>
            		<p:selectBooleanCheckbox value="#{x.systemEntry}" rendered="#{cc.attrs.edition}" />
        		</p:column>

            	<p:column headerText="Amount" styleClass="wex-cell-righted" style="max-width:160px; width:160px">
            		<h:outputText value="#{x.currencyAmount} #{cc.attrs.expense.currencyCode}" rendered="#{not cc.attrs.edition}"/>
            		<p:inputNumber value="#{x.currencyAmount}" rendered="#{cc.attrs.edition}"
            			symbol=" #{cc.attrs.expense.currencyCode}" symbolPosition="suffix" 
            			thousandSeparator="'" styleClass="wex-input-right wex-input-150"  />
        		</p:column>
        		
            	<p:column headerText="Value" styleClass="wex-cell-righted" style="max-width:120px; width:120px">
            		<h:outputText value="#{x.accountingValue}" />
        		</p:column>
        		
        		<p:column headerText="Tags" >
        			<h:panelGroup rendered="#{not cc.attrs.edition}">
        				<ui:repeat var="t" value="#{x.tags}">#{t.name}</ui:repeat>
        			</h:panelGroup>
        			<h:panelGroup rendered="#{cc.attrs.edition}">
        				<p:autoComplete id="tagsId" multiple="true" value="#{x.tagsList}" completeMethod="#{dropboxController.completeTag}"
                        	var="theme" itemLabel="#{theme.name}" itemValue="#{theme}" converter="#{tagConverter}" forceSelection="true">		 
				            <p:column>
				                <h:outputText value="#{theme.name}" />
				            </p:column>
				        </p:autoComplete>
        			</h:panelGroup>
        		</p:column>
         </p:dataTable>
   	</composite:implementation>
</ui:component>