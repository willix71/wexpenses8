<ui:component xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:c="http://java.sun.com/jstl/core"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:wex="http://java.sun.com/jsf/composite/wex-cc"
	xmlns:composite="http://java.sun.com/jsf/composite">
   	
	<composite:interface>
		<composite:attribute name="rows" default="1000" />
	</composite:interface>
	
	<composite:implementation>
		<c:set var="conso" value="#{consolidationEditionController.currentElement}" />
			
		<wex:dbableDetails dbable="#{conso}"/>
		
		<h:panelGrid columns="2" rendered="#{not empty conso}" style="width:100%">
			<h:outputText value=""/>
			<p:messages showDetail="true" showSummary="true" />
			
			<h:outputText value="date" styleClass="wex-field-label"/>
			<p:datePicker value="#{conso.date}"  view="month"  
				pattern="MMM yyyy"
				showIcon="true"
				showButtonBar="true"
				appendTo="@(body)"
				styleClass="wex-small-datepicker js-date-related">
				<p:ajax event="dateSelect" listener="#{consolidationEditionController.updateDate}" update="consoTransactionEntries" />
			</p:datePicker>
		
			<h:outputText value="institution" styleClass="wex-field-label"/>
			<p:outputPanel id="payeeSelector">
				<wex:payeeSelector payee="#{conso.institution}" edition="true" handleSelect="#{consolidationEditionController.updateInstitution}" update="@(.wex-conso-picklist)"/>
			</p:outputPanel>
			
			<h:outputText value="document" styleClass="wex-field-label"/>
			<p:outputPanel id="documentFileSelector">
				<wex:documentFileEdition docFile="#{conso.documentFile}" extra="#{conso}" edition="true" />
			</p:outputPanel>

			<h:outputText value="values" styleClass="wex-field-label"/>
			<p:outputPanel>
				<h:outputLabel value="opening" styleClass="wex-field-label" style="padding-right:5px"/>
			    <p:inputNumber value="#{conso.openingValue}" thousandSeparator="'" label="opening" style="padding-right:20px"/>
				<h:outputLabel value="closing" styleClass="wex-field-label" style="padding-right:5px"/>
			    <p:inputNumber value="#{conso.closingValue}" thousandSeparator="'" label="closing" style="padding-right:20px"/>
				<h:outputLabel value="delta" styleClass="wex-field-label" style="padding-right:5px"/>
				<h:outputText id="deltaValue" value="#{conso.deltaValue}" style="padding-right:20px"/>										
				<h:outputLabel value="in" styleClass="wex-field-label" style="padding-right:5px"/>
			    <h:outputText value="#{consolidationEditionController.totalIn}" thousandSeparator="'" label="in" style="padding-right:20px"/>
				<h:outputLabel value="out" styleClass="wex-field-label" style="padding-right:5px"/>
			    <h:outputText value="#{consolidationEditionController.totalOut}" thousandSeparator="'" label="out" style="padding-right:20px"/>
			</p:outputPanel>
		</h:panelGrid>
	
	    <p:pickList id="consoTransactionEntries" styleClass="js-wexTable wex-conso-picklist" var="xct" value="#{consolidationEditionController.entries}"
                itemValue="#{xct}" itemLabel="#{xct.uid}" converter="#{transactionEntryConverter}" 
                showTargetControls="true" 
                showCheckbox="false"
                responsive="true">
 
		        <f:facet name="sourceCaption">
					<p:autoComplete multiple="true" value="#{consolidationEditionController.sourceTags}" completeMethod="#{dropboxController.completeTag}" unique="true" var="theme"
						itemLabel="#{theme.name}" itemValue="#{theme}" converter="#{tagConverter}" forceSelection="true" styleClass="wex-field-edit wex-tags">
						<p:column>
							<h:outputText value="#{theme.name}" styleClass="wex-tags-#{theme.type}" />
						</p:column>
						<p:ajax event="itemSelect" listener="#{consolidationEditionController.updateInstitution}" />
						<p:ajax event="itemUnselect" listener="#{consolidationEditionController.updateInstitution}" />
					</p:autoComplete>
				</f:facet>
		        <f:facet name="targetCaption">
					<p:autoComplete multiple="true" value="#{consolidationEditionController.targetTags}" completeMethod="#{dropboxController.completeTag}" unique="true" var="theme"
						itemLabel="#{theme.name}" itemValue="#{theme}" converter="#{tagConverter}" forceSelection="true" styleClass="wex-field-edit wex-tags">
						<p:column>
							<h:outputText value="#{theme.name}" styleClass="wex-tags-#{theme.type}" />
						</p:column>
					</p:autoComplete>
		        </f:facet>
		 
		        <p:ajax event="transfer" listener="#{consolidationEditionController.onTransfer}" update="@form" />
		        <p:ajax event="reorder" listener="#{consolidationEditionController.onReorder}" />
				
				<p:column style="width:40px;min-width:40px" >
					<h:outputText value="#{xct.accountingOrder % 1000})" rendered="#{not empty xct.accountingOrder}"/>
				</p:column>

				<p:column headerText="Date" styleClass="wex-cell-righted" style="width:90px" >
					<h:outputText value="#{xct.accountingDate}" >
						<f:convertDateTime type="localDateTime" pattern="dd/MM/yyyy" />
					</h:outputText>
				</p:column>
			
				<p:column headerText="Payee" style="width:100%">
					<p:outputPanel>
						<h:outputText value="#{xct.expense.payee.prefix}#{xct.expense.payee.name} #{xct.expense.payee.extra}" /><br/>
						<h:outputText value="#{xct.currencyAmount} #{xct.expense.currencyCode}" rendered="#{xct.expense.currencyCode!='CHF'}"/>
					</p:outputPanel>
				</p:column>
						
				<p:column headerText="IN" styleClass="wex-cell-righted" style="width:80px;min-width:80px" >
					<h:outputText value="#{xct.accountingValue}" rendered="#{xct.factor=='IN'}"/>
				</p:column>
			
				<p:column headerText="OUT" styleClass="wex-cell-righted"  style="width:80px;min-width:80px" >
					<h:outputText value="#{xct.accountingValue}" rendered="#{xct.factor=='OUT'}"/>
				</p:column>
			
				<p:column headerText="Balance" styleClass="wex-cell-righted"  style="width:80px;min-width:80px" >
					<h:outputText value="#{xct.accountingBalance}" />
				</p:column>
		</p:pickList>
		
	    <h:panelGroup style="width:100%;display:flex;align-items:center;justify-content:space-between">
     		<p:commandButton id="wexSave" value="Save" update="wexEditionForm" >
				<f:actionListener binding="#{consolidationEditionController.save()}" />
			</p:commandButton>
     		<p:commandButton id="wexRefresh" value="Refresh" update="wexEditionForm" >
				<f:actionListener binding="#{consolidationEditionController.compute()}" />
			</p:commandButton>
       	</h:panelGroup>
       	
   	</composite:implementation>
</ui:component>