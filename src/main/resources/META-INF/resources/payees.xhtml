<ui:composition 
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core" 
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:wex="http://java.sun.com/jsf/composite/wex-cc"
	template="templates/main-template.xhtml"
	>

	<ui:define name="title">Wexpenses Payees</ui:define>

	<ui:define name="content">
		<h:form id="payeesTableForm">
			<p:growl id="growl" />
			
			<p:fieldset id="criteriaFields" legend="Filter" toggleable="true" toggleSpeed="500">
		        <h:panelGrid columns="3" cellpadding="2">  
					<h:inputText id="payeeContains" value="#{payeeController.criteria.text}" />
					
					<p:commandButton id="filterPayeesBtn" icon="pi pi-search" value="Update" type="submit" action="#{payeeController.refresh}" update="payeesTable" />
					<p:commandButton id="resetFilterBtn" icon="pi pi-times" value="Reset" type="submit" action="#{payeeController.reset}" update="criteriaFields payeesTable" />
				</h:panelGrid>
			</p:fieldset>
			
			<p:dataTable id="payeesTable" styleClass="js-payeesTable" var="x" value="#{payeeController.payees}" resizableColumns="true"
                 paginator="true"
                 paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                 currentPageReportTemplate="{startRecord}-{endRecord} of {totalRecords} records"
                 rowsPerPageTemplate="5,10,50,100,1000"
				 rows="10"
                 rowKey="#{x.uid}"
                 selection="#{payeeController.selectedPayee}" 
                 selectionMode="single"
                 >
                
                <p:column headerText="Id" sortBy="#{x.id}">
            		<h:outputText value="#{x.fullId}" />
        		</p:column>
        		  
        		<p:column headerText="Type" sortBy="#{x.payeeType.name}" filterBy="#{x.payeeType.name}" filterMatchMode="contains">
            		<h:outputText value="#{x.payeeType.name}" />
        		</p:column>

            	<p:column headerText="Name" sortBy="#{x.prefix}#{x.name} #{x.extra}" filterBy="#{x.prefix}#{x.name} #{x.extra}" filterMatchMode="contains">
            		<h:outputText value="#{x.prefix}#{x.name} #{x.extra}" />
        		</p:column>
        		
        		<p:column headerText="City" sortBy="#{x.zip} #{x.city} #{x.countryCode}" filterBy="#{x.zip} #{x.city} #{x.countryCode}" filterMatchMode="contains">
            		<h:outputText value="#{x.zip} #{x.city} #{x.countryCode}" />
        		</p:column>

        		<p:column headerText="CCP" sortBy="#{x.postalAccount}" filterBy="#{x.postalAccount}" filterMatchMode="contains">
            		<h:outputText value="#{x.postalAccount}" />
        		</p:column>

        		<p:column headerText="Iban" sortBy="#{x.iban}" filterBy="#{x.iban}" filterMatchMode="contains">
            		<h:outputText value="#{x.iban}" />
        		</p:column>
			</p:dataTable>
			
			<p:contextMenu for="payeesTable">
		        <p:menuitem value="View" update="payeeDetailPanel" icon="pi pi-eye" oncomplete="PF('w_payeeDetailDialog').show()"/>
		        <p:menuitem value="Edit" update="payeeEditionForm" icon="pi pi-pencil" oncomplete="PF('w_payeeEditionDialog').show()"/>
		        <p:menuitem value="Delete" update="payeeDeletePanel" icon="pi pi-trash" oncomplete="PF('w_payeeDeleteDialog').show()"/>
		        <p:menuitem value="New" update="payeeEditionForm" icon="pi pi-plus" action="#{payeeController.newPayee}" oncomplete="PF('w_payeeEditionDialog').show()"/>
		        <p:menuitem value="Refresh" update="payeesTable" icon="pi pi-replay" action="#{payeeController.refresh}"/>
		    </p:contextMenu>
     
			<p:outputPanel id="payeeDetailPanel">
	 			<p:dialog id="payeeDetailDialog" widgetVar="w_payeeDetailDialog" header="UID:#{payeeController.selectedPayee.uid}" position="top">
					<wex:payeeEdition payee="#{payeeController.selectedPayee}" edition="false"/>
				</p:dialog>
			</p:outputPanel>

			<p:outputPanel id="payeeDeletePanel">
	 			<p:dialog id="payeeDeleteDialog" widgetVar="w_payeeDeleteDialog" header="UID:#{payeeController.selectedPayee.uid}" position="top" modal="true">
					<wex:payeeEdition payee="#{payeeController.selectedPayee}" edition="false"/>
					<p:commandButton id="payeeDeleteBtn" value="Delete" type="submit" action="#{payeeController.delete}" oncomplete="PF('w_payeeDeleteDialog').hide()" update="@('.js-payeesTable')"/>
					<p:commandButton id="payeeCancelDeleteBtn" value="Cancel" type="button" onclick="PF('w_payeeDeleteDialog').hide()" />
				</p:dialog>
			</p:outputPanel>
		</h:form>
		
		<h:form id="payeeEditionForm" >
			<p:dialog id="payeeEditionDialog" widgetVar="w_payeeEditionDialog" header="UID:#{payeeController.selectedPayee.uid}" position="top" modal="true">
				<p:outputPanel id="payeeEditionPanel">
					<wex:payeeEdition payee="#{payeeController.selectedPayee}" edition="true"/>
				</p:outputPanel>
				<p:commandButton id="payeeSave" value="Save" action="#{payeeController.save}" oncomplete="if (args &amp;&amp; args.isSaved) PF('w_payeeEditionDialog').hide()" update="payeeEditionPanel :payeesTableForm:payeesTable"/>
				<p:commandButton id="payeeCancel" value="Cancel" onclick="PF('w_payeeEditionDialog').hide()" />
			</p:dialog>
		</h:form>
	</ui:define>
</ui:composition>	
