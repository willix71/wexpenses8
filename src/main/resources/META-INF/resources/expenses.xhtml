<ui:composition 
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core" 
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:wex="http://java.sun.com/jsf/composite/wex-cc"
	template="templates/main-template.xhtml"
	>

	<ui:define name="title">Wexpenses Expenses</ui:define>

	<ui:define name="content">
		<h:form id="expensesTableForm">
			<p:growl id="growl" />
			
			<p:fieldset id="criteriaFields" legend="Filter" toggleable="true" toggleSpeed="500">
		        <h:panelGrid columns="3" cellpadding="2">  
					
					<p:commandButton id="filterExpensesBtn" icon="pi pi-replay" value="Update" type="submit" action="#{expenseController.refresh}" update="expensesTable" />
					<p:commandButton id="resetFilterBtn" icon="pi pi-times" value="Reset" type="submit" action="#{expenseController.reset}" update="criteriaFields expensesTable" />
				</h:panelGrid>
			</p:fieldset>
			
			<p:dataTable id="expensesTable" styleClass="js-expensesTable" var="x" value="#{expenseController.expenses}" resizableColumns="true"
                 paginator="true"
                 paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                 currentPageReportTemplate="{startRecord}-{endRecord} of {totalRecords} records"
                 rowsPerPageTemplate="5,10,50,100,1000"
				 rows="10"
                 rowKey="#{x.id}"
                 selection="#{expenseController.selectedExpense}" 
                 selectionMode="single"
                 >
        
        		<p:column headerText="Type" style="width:10%;">
            		<h:outputText value="#{x.expenseType.name}" />
        		</p:column>

            	<p:column headerText="Payee" style="width:35%;">
            		<h:outputText value="#{x.payee.prefix}#{x.payee.name} #{x.payee.extra}" />
        		</p:column>
        		
        		<p:column headerText="City" style="width:15%;">
            		<h:outputFormat value="{0,date,dd/MM/yyyy HH:mm}">
						<f:param value="#{x.date}" />
					</h:outputFormat>
        		</p:column>

        		<p:column headerText="Amount" style="width:15%;">
            		<h:outputText value="#{x.currencyAmount}" />
        		</p:column>

        		<p:column headerText="Currency" style="width:15%;">
            		<h:outputText value="#{x.currencyCode}" />
        		</p:column>
			</p:dataTable>
			
			<p:contextMenu for="expensesTable">
		        <p:menuitem value="View" update="expenseDetailPanel" icon="pi pi-eye" oncomplete="PF('w_expenseDetailDialog').show()"/>
		        <p:menuitem value="Edit" update="expenseEditionForm" icon="pi pi-pencil" oncomplete="PF('w_expenseEditionDialog').show()"/>
		        <p:menuitem value="Delete" update="expenseDeletePanel" icon="pi pi-trash" oncomplete="PF('w_expenseDeleteDialog').show()"/>
		        <p:menuitem value="New" update="expenseEditionForm" icon="pi pi-plus" action="#{expenseController.newExpense}" oncomplete="PF('w_expenseEditionDialog').show()"/>
		        <p:menuitem value="Refresh" update="expensesTable" icon="pi pi-replay" action="#{expenseController.refresh}"/>
		    </p:contextMenu>
     
			<p:outputPanel id="expenseDetailPanel">
	 			<p:dialog id="expenseDetailDialog" widgetVar="w_expenseDetailDialog" header="UID:#{expenseController.selectedExpense.uid}" position="top">
					<wex:expenseEdition expense="#{expenseController.selectedExpense}" edition="false"/>
				</p:dialog>
			</p:outputPanel>

			<p:outputPanel id="expenseDeletePanel">
	 			<p:dialog id="expenseDeleteDialog" widgetVar="w_expenseDeleteDialog" header="UID:#{expenseController.selectedExpense.uid}" position="top" modal="true">
					<wex:expenseEdition expense="#{expenseController.selectedExpense}" edition="false"/>
					<p:commandButton id="expenseDeleteBtn" value="Delete" type="submit" action="#{expenseController.delete}" oncomplete="PF('w_expenseDeleteDialog').hide()" update="@('.js-expensesTable')"/>
					<p:commandButton id="expenseCancelDeleteBtn" value="Cancel" type="button" onclick="PF('w_expenseDeleteDialog').hide()" />
				</p:dialog>
			</p:outputPanel>
		</h:form>
		
		<h:form id="expenseEditionForm" >
			<p:outputPanel id="expenseEditionPanel">
	 			<p:dialog id="expenseEditionDialog" widgetVar="w_expenseEditionDialog" header="UID:#{expenseController.selectedExpense.uid}" position="top" modal="true">
					<wex:expenseEdition expense="#{expenseController.selectedExpense}" edition="true"/>
					<p:commandButton id="expenseSave" value="Save" type="submit" action="#{expenseController.save}" oncomplete="PF('w_expenseEditionDialog').hide()" update="@('.js-expensesTable')"/>
					<p:commandButton id="expenseCancel" value="Cancel" type="button" onclick="PF('w_expenseEditionDialog').hide()" />
				</p:dialog>
			</p:outputPanel>
		</h:form>
	</ui:define>
</ui:composition>	
